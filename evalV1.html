<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Évaluation des Compétences</title>
   <style>
      /* --- Styles Généraux --- */
      body {
         font-family: Arial, sans-serif;
         margin: 0;
         padding: 12px;
         background-color: #f8f9fa;
         color: #333;
      }

      button {
         background: linear-gradient(135deg, #4a90e2, #357ABD);
         color: white;
         border: none;
         border-radius: 12px;
         padding: 2px 7px;
         font-size: 12px;
         font-weight: 500;
         cursor: pointer;
         transition: all 0.3s ease;
         box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
         position: relative;
         overflow: hidden;
         height: 30px;
         width: 70px;
      }

      button::before {
         content: '';
         position: absolute;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background: rgba(255, 255, 255, 0.15);
         transform: translateX(-100%);
         transition: transform 0.4s ease;
      }

      button:hover::before {
         transform: translateX(100%);

      }

      button:hover {
         background: linear-gradient(135deg, #357ABD, #4a90e2);
         box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
      }

      button:active {
         transform: scale(0.98);

      }

      h1 {
         text-align: center;
         color: #444;
         margin-bottom: -10px;
         font-size: 25px;
      }

      h3 {
         font-size: 16px;
         color: #333;
         margin-bottom: 10px;
      }

      p {
         font-size: 1rem;
         line-height: 1.1;
         color: #555;
      }

      /* --- style des 3 onglets --- */

      .tabs {
         display: flex;
         flex-direction: row;
         justify-content: space-between;
         /* margin-block: 15px; */
         border-bottom: 2px solid #ccc;
      }

      .tab {
         padding: 10px 20px;
         font-size: 16px;
         font-weight: 500;
         cursor: pointer;
         transition: all 0.3s ease;
         border-radius: 8px 8px 0 0;
         /* Coins arrondis sur le dessus */
      }

      /* Onglet actif */
      .tab.active {
         background-color: #4a90e2;
         /* Couleur bleu clair */
         color: white;
         border-bottom: 3px solid #4a90e2;
         /* Bordure visible pour l'onglet actif */
         box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
         /* Ombre douce */
      }

      /* Onglet inactif */
      .tab.inactive {
         background-color: #f4f4f4;
         /* Couleur de fond grise claire */
         color: #777;
         /* Texte gris */
         border-bottom: 3px solid transparent;
         /* Pas de bordure sous l'onglet inactif */
      }

      .tab:hover {
         background-color: #e1e1e1;
         /* Changement de couleur au survol */
         color: #333;
         /* Assombrissement du texte lors du survol */
      }

      /* --- Conteneur Résultats --- */
      .result-container {
         display: flex;
         flex-direction: column;
         gap: 10px;
         margin-top: 30px;
      }

      .result-box {
         padding: 12px;
         border: 1px solid #ccc;
         border-radius: 8px;
         background-color: #fff;
         display: none;
      }

      .result-box h3 {
         margin-bottom: 10px;
         font-size: 1.2rem;
         color: #444;
      }

      .result-box p {
         font-size: 1rem;
         font-weight: bold;
         color: #222;
      }

      .info-evaluation {
         margin-top: 8px;
         font-size: 0.9rem;
         color: #666;
         text-align: justify;
      }

      /* --- Formulaires --- */
      .form-container {
         display: flex;
         position: relative;
         flex-wrap: wrap;
         justify-content: center;
         align-items: center;
         gap: 2%;
         width: 92%;
         top: -15px;
         background: #fff;
         padding: 8px;
         border-radius: 8px;
         border: 1px solid #ccc;
      }

      .form-group {
         width: 48%;
         margin-bottom: 6px;
      }

      .form-group label {
         display: block;
         margin-bottom: 3px;
         font-weight: bold;
         font-size: 0.95rem;
      }

      .form-group input,
      .remark-area {
         padding: 6px;
         font-size: 14px;
         border: 1px solid #ccc;
         border-radius: 5px;
         width: 100%;
         /* S'assurer que tous les éléments prennent la largeur disponible */
         box-sizing: border-box;
         /* Prendre en compte le padding dans la largeur totale */
      }

      .remark-area {
         resize: none;
         min-height: 40px;
      }

      .form-group.full-width {
         width: 98%;
      }

      /* --- Catégories --- */
      .category-container {
         display: grid;
         grid-template-rows: 2;

         margin-bottom: 5px;
         padding: 10px;
         border: 1px solid #ccc;
         border-radius: 8px;
         background-color: #fff;
      }

      .category-header {
         display: flex;
         position: relative;
         top: -20px;
         width: 100%;
         justify-content: space-between;
         font-size: 12px;
         font-weight: bold;
         color: #333;
      }

      .criteria-grid {
         display: grid;
         grid-template-columns: repeat(auto-fill, minmax(24%, 1fr));
         gap: 15px;
         margin-top: -20px;
      }

      .criterion-card {
         display: flex;
         flex-direction: column;
         gap: 8px;
         padding: 5px;
         border-left: 2px solid #007bff;
         background: #f9f9f9;
         border-radius: 5px;
      }

      .criterion-name {
         font-size: 1rem;
         font-weight: bold;
         color: #444;
      }

      .slider-container {
         z-index: 10;
      }

      /* Curseur */
      .slider {
         width: 99%;
         height: 8px;
         border-radius: 5px;
         background: #ddd;
         /* Couleur unie pour la piste */
         -webkit-appearance: none;
         appearance: none;
         outline: none;
         transition: background 0.3s ease;
         /* Transition fluide sur le fond */

      }

      /* Effet au survol de la piste */
      .slider:hover {
         background: #afb1db;
         /* Piste un peu plus foncée au survol */

      }

      /* Curseur désactivé */
      .slider:disabled {
         background: #e0e0e0;
         /* Couleur plus claire pour indiquer qu'il est désactivé */
      }

      /* Bouton du curseur */
      .slider::-webkit-slider-thumb {
         -webkit-appearance: none;
         appearance: none;
         width: 20px;
         height: 20px;
         background-color: #007bff;
         /* Couleur bleue */
         border-radius: 50%;
         cursor: pointer;
         transition: background-color 0.3s ease;
         /* Transition sur la couleur du bouton */
      }

      /* Effet au survol du bouton */
      .slider::-webkit-slider-thumb:hover {
         background-color: #0056b3;
         /* Couleur plus foncée au survol */
      }

      /* Bouton désactivé */
      .slider:disabled::-webkit-slider-thumb {
         background-color: #b0b0b0;
         /* Couleur plus claire pour le bouton désactivé */
         cursor: not-allowed;
         /* Le curseur devient une croix pour indiquer l'inactivité */
      }

      /* Pour Firefox */
      .slider::-moz-range-thumb {
         width: 20px;
         height: 20px;
         background-color: #007bff;
         border-radius: 50%;
         cursor: pointer;
         transition: background-color 0.3s ease;
      }

      .slider::-moz-range-thumb:hover {
         background-color: #0056b3;
      }

      /* Bouton désactivé pour Firefox */
      .slider:disabled::-moz-range-thumb {
         background-color: #b0b0b0;
         /* Couleur plus claire pour le bouton désactivé */
         cursor: not-allowed;
         /* Le curseur devient une croix pour indiquer l'inactivité */
      }

      /* Valeur du curseur */
      .slider-value {
         font-size: 0.9rem;
         color: #333;
         text-align: right;
      }

      /* --- Étudiants --- */
      .student-info {
         display: grid;
         padding: 5px;
         background: #e9f1f9;
         border: 1px solid #ccd9e6;
         border-radius: 8px;
         margin: 10px 10%;
         justify-items: center;
         /* Centre horizontalement les éléments à l'intérieur */
         align-items: center;
         /* Centre verticalement les éléments à l'intérieur */
         height: 100%;
      }

      .student-info h3 {
         font-size: 16px;
         margin-bottom: 5px;
         color: #007bff;
      }

      [id^="auto-"] {
         background-color: #22f834;
         border: 1px solid #ccc;
         padding: 2px;
         box-sizing: border-box;
      }


      [id^="formative-"] {
         background-color: #f3b33c;
         border: 1px solid #ccc;
         padding: 2px;
         box-sizing: border-box;
      }


      [id^="sommative-"] {
         background-color: #eb4c25;
         border: 1px solid #ccc;
         padding: 2px;
         box-sizing: border-box;

      }

      .labelEval {
         visibility: hidden;
      }

      /* Position relative pour les spans d'appréciation */
      .appreciation-labels {
         position: relative;
         top: -120px;
         display: flex;
         justify-content: space-between;
         margin-inline: 15px;
         height: 50px;
         /* Hauteur ajustée pour contenir correctement les labels */
         margin-bottom: -50px;
         /* Ajoute un espacement en bas si nécessaire */
      }

      /* Ajouter les traits verticaux */
      .appreciation-labels::before {
         content: '';
         position: absolute;
         top: 15px;
         /* Commence le trait à partir du haut du conteneur */
         bottom: -70px;
         /* Fin du trait en bas du conteneur */
         left: 0;
         width: 100.3%;
         /* S'assure que le trait s'étend sur toute la largeur */
         background: linear-gradient(to right,
               transparent 0%,
               /* Pas de ligne avant 0% */
               #ccc 0%,
               /* Ligne à 0% */
               #ccc 1px,
               /* Largeur du trait à 0% */
               transparent 1px,
               /* Espace après la ligne à 0% */
               transparent 33.4%,
               /* Ligne à 33.6% */
               #ccc 33.4%,
               /* Ligne à 33.6% */
               #ccc calc(33.4% + 1px),
               /* Largeur du trait à 33.6% */
               transparent calc(33.4% + 1px),
               /* Espace après la ligne à 33.6% */
               transparent 66.6%,
               /* Ligne à 66.8% */
               #ccc 66.6%,
               /* Ligne à 66.8% */
               #ccc calc(66.6% + 1px),
               /* Largeur du trait à 66.8% */
               transparent calc(66.6% + 1px),
               /* Espace après la ligne à 66.8% */
               transparent 99.9%,
               /* Pas de ligne entre 66%99.8 et 100% */
               #ccc 99.9%,
               /* Ligne à 100% */
               #ccc calc(99.9% + 1px)
               /* Largeur du trait à 100% */
            );
         pointer-events: none;
         /* Empêche l'interaction avec le trait */
         z-index: 1;
         /* Met le trait derrière les éléments comme les sliders */
      }


      /* Labels */
      .appreciation-labels span {
         position: absolute;
         /* Place les labels sous les traits */
         transform: translateX(-50%);
         white-space: nowrap;
         font-size: 12px;
         /* Ajuster la taille des labels */
      }

      /* Positions des labels */
      .appreciation-labels span:nth-child(1) {
         left: 0%;
      }

      .appreciation-labels span:nth-child(2) {
         left: 33.4%;
      }

      .appreciation-labels span:nth-child(3) {
         left: 66.9%;
      }

      .appreciation-labels span:nth-child(4) {
         left: 100.3%;
      }

      /* Checkbox pour exclure */
      .exclude-checkbox {
         margin-top: 10px;
      }

      .exclude-checkbox label {
         display: flex;
         align-items: center;
         gap: 5px;
      }

      /* --- Classes Utilitaires --- */
      .hidden {
         display: none;
      }
   </style>

</head>

<body>
   <h1>Évaluation des Compétences</h1>

   <!-- Informations de l'élève -->
   <div class="student-info" id="student-info">

      <div class="category-header">
         <h3>INFORMATICIEN-NE</h3>
         <!-- Bouton pour cacher/afficher les infos de l'élève -->
         <button id="toggle-student-info" onclick="toggleStudentInfo()">Cacher ▲</button>
      </div>

      <div class="form-container">
         <div class="form-group">
            <label for="project-name">Nom du projet :</label>
            <input type="text" id="project-name" placeholder="Saisir le nom du projet">
         </div>

         <div class="form-group">
            <label for="evaluation-date">Date de l'évaluation :</label>
            <input type="date" id="evaluation-date">
         </div>

         <div class="form-group">
            <label for="student-name">Nom et prénom de l'élève :</label>
            <input type="text" id="student-name" placeholder="Saisir le nom et prénom">
         </div>

         <div class="form-group">
            <label for="student-class">Classe :</label>
            <input type="text" id="student-class" placeholder="Saisir la classe">
         </div>

         <div class="form-group full-width">
            <label for="remarks">Remarques :</label>
            <textarea id="remarks" class="remark-area" rows="4" placeholder="Ajoutez vos remarques ici..."></textarea>
         </div>
      </div>
   </div>

   <!-- Onglets pour changer de type d'évaluation -->
   <div class="tabs">
      <div id="tabAuto" class="tab active" onclick="changeTab('auto')">Auto-évaluation</div>
      <div id="tabFormative" class="tab inactive" onclick="changeTab('formative')">Évaluation formative</div>
      <div id="tabsommative" class="tab inactive" onclick="changeTab('sommative')">Évaluation sommative</div>
   </div>

   <!-- Sections des catégories -->
   <div id="categories"></div>


   <!-- Conteneur pour afficher les résultats des trois onglets -->
   <div id="result-container" class="result-container">
      <div class="result-box" id="auto-result-box">
         <h3>Auto-évaluation</h3>
         <p id="auto-average">0</p>
         <span class="info-evaluation">
            L’auto-évaluation permet à l’élève de réfléchir sur ses propres performances et progrès.
            Elle encourage la prise de conscience et l’autonomie dans le processus d’apprentissage.
         </span>
      </div>

      <div class="result-box" id="formative-result-box">
         <h3>Évaluation Formative</h3>
         <p id="formative-average">0</p>
         <span class="info-evaluation">
            L’évaluation formative est un outil continu qui vise à guider l’apprentissage des élèves.
            Elle permet d’identifier les forces et les domaines à améliorer pour progresser.
         </span>
      </div>

      <div class="result-box" id="sommative-result-box">
         <h3>Évaluation Sommative</h3>
         <p id="sommative-average">0</p>
         <span class="info-evaluation">
            L’évaluation sommative se déroule à la fin d’une période d’apprentissage (comme un semestre ou une année
            scolaire).
            Elle vise à évaluer les acquis des élèves par rapport à un référentiel ou à des normes.
         </span>
      </div>
   </div>



   <!-- JAVASCRIPT  -->

   <script>
      let isStudentInfoVisible = true;

      const appreciationLabels = ["NA", "PA", "A", "LA"];

      const visibleCategories = {
         PROFESSIONNELLES: true,
         METHODOLOGIQUES: true,
         SOCIALES: true
      };

      const criteria = [
         { id: 1, name: 'Rythme de travail', category: 'PROFESSIONNELLES' },
         { id: 2, name: 'Qualité du travail', category: 'PROFESSIONNELLES' },
         { id: 3, name: 'Niveau de maîtrise technique', category: 'PROFESSIONNELLES' },
         { id: 4, name: 'Autonomie', category: 'PROFESSIONNELLES' },
         { id: 5, name: 'Processus de travail', category: 'METHODOLOGIQUES' },
         { id: 6, name: 'Expression orale et écrite', category: 'METHODOLOGIQUES' },
         { id: 7, name: 'Durabilité et innovation', category: 'METHODOLOGIQUES' },
         { id: 8, name: 'Aptitude au travail en équipe', category: 'SOCIALES' }
      ];

      let sliderValues = {
         auto: {},
         formative: {},
         sommative: {}
      };

      let currentTab = 'auto'; // Par défaut, l'onglet actif est l'auto-évaluation

      // Restauration des valeurs des sliders au rendu des catégories
      function renderCategories() {
         const categoriesDiv = document.getElementById('categories');
         categoriesDiv.innerHTML = ''; // Réinitialiser l'affichage

         const groupedCriteria = criteria.reduce((acc, crit) => {
            const category = crit.category.trim().toUpperCase();
            acc[category] = acc[category] || [];
            acc[category].push(crit);
            return acc;
         }, {});

         Object.keys(groupedCriteria).forEach(category => {
            const container = document.createElement('div');
            container.className = 'category-container';
            container.style.maxHeight = visibleCategories[category] ? '1000px' : '15px';

            const header = document.createElement('div');
            header.className = 'category-header';
            header.innerHTML = `
            <h2>${category}</h2>
            <button onclick="toggleCategoryVisibility('${category}')">
                ${visibleCategories[category] ? 'Cacher ▲' : 'Afficher ▼'}
            </button>`;
            container.appendChild(header);

            const criteriaDiv = document.createElement('div');
            criteriaDiv.className = 'criteria-grid';
            groupedCriteria[category].forEach(crit => {
               const card = document.createElement('div');
               card.className = 'criterion-card';
               card.innerHTML = `
    <div class="criterion-name">${crit.name}</div>
    <div class="slider-container">
        ${['auto', 'formative', 'sommative'].map(level => `
            <label class='labelEval'>${level.charAt(0).toUpperCase() + level.slice(1)}:</label>
            <input type="range" min="0" max="3" class="slider" id="${level}-${crit.id}"
                   data-id="${crit.id}" data-level="${level}"
                   value="${sliderValues[level]?.[crit.id] || 0}"
                   oninput="updateSliderValue(this)" 
                   ${currentTab !== level ? 'disabled' : ''}>
        `).join('')}
    </div>
    <div class="appreciation-labels">
        ${appreciationLabels.map((label, i) => `
            <span id="${label}-${currentTab}-${crit.id}">${label}</span>
        `).join('')}
    </div>
    <div id="result-${crit.id}" class="result-box bg-gray">
        ${appreciationLabels[sliderValues[currentTab]?.[crit.id] || 0]}
    </div>
    <div class="exclude-checkbox">
        <label>
            <input type="checkbox" id="exclude-${crit.id}" onclick="toggleExclusion(${crit.id})"
                   ${excludedCriteria[crit.id] ? 'checked' : ''}>
            Exclure de l'évaluation
        </label>
    </div>
`;

               criteriaDiv.appendChild(card);
            });

            container.appendChild(criteriaDiv);
            categoriesDiv.appendChild(container);
         });

         // Initialiser les valeurs des sliders après avoir rendu les catégories
         initializeSliderValues();
      }


      function toggleStudentInfo() {
         const studentInfo = document.getElementById('student-info');
         const toggleButton = document.getElementById('toggle-student-info');
         const secondDiv = studentInfo.querySelector('.form-container');

         isStudentInfoVisible = !isStudentInfoVisible;

         if (isStudentInfoVisible) {
            toggleButton.innerText = 'Cacher ▲';
            secondDiv.style.display = '';
            studentInfo.style.maxHeight = '';

         } else {
            toggleButton.innerText = 'Afficher ▼';
            secondDiv.style.display = 'none';
            studentInfo.style.maxHeight = '40px';
         }
      }

      function toggleCategoryVisibility(category) {
         visibleCategories[category] = !visibleCategories[category];
         renderCategories();
      }

      // Recalcul automatique lors de l'interaction avec un slider ou une exclusion
      function updateSliderValue(slider) {
         const id = slider.dataset.id;
         const level = slider.dataset.level;
         const value = slider.value;

         sliderValues[level][id] = value; // Mémoriser la valeur
         document.getElementById(`result - ${id}`).textContent = appreciationLabels[value]; // Mettre à jour l'appréciation

         calculateFinalResults(); // Recalculer les résultats
      }


      function toggleCategoryVisibility(category) {
         visibleCategories[category] = !visibleCategories[category];
         renderCategories();
      }

      function getDateDefault() {
         // Obtenir la date actuelle
         const today = new Date();

         // Formater la date au format YYYY-MM-DD
         const yyyy = today.getFullYear();
         let mm = today.getMonth() + 1; // Les mois commencent à 0
         let dd = today.getDate();

         // Ajouter un zéro devant les mois ou jours inférieurs à 10
         if (mm < 10) mm = '0' + mm;
         if (dd < 10) dd = '0' + dd;

         // Construire la date au format nécessaire
         const todayFormatted = `${yyyy} - ${mm} - ${dd}`;

         // Affecter la date au champ input
         document.getElementById('evaluation-date').value = todayFormatted;
      }

      function changeTab(tab) {
         currentTab = tab;

         // Retirer la classe 'active' de tous les onglets
         document.getElementById('tabAuto').classList.remove('active');
         document.getElementById('tabFormative').classList.remove('active');
         document.getElementById('tabsommative').classList.remove('active');

         document.getElementById('tabAuto').classList.remove('inactive');
         document.getElementById('tabFormative').classList.remove('inactive');
         document.getElementById('tabsommative').classList.remove('inactive');

         // Ajouter la classe 'active' à l'onglet sélectionné
         if (tab === 'auto') {
            document.getElementById('tabAuto').classList.add('active');
         } else if (tab === 'formative') {
            document.getElementById('tabFormative').classList.add('active');
         } else {
            document.getElementById('tabsommative').classList.add('active');
         }

         // Mettre à jour les catégories en fonction de l'onglet sélectionné
         renderCategories();
      }

      let excludedCriteria = {}; // Un objet pour suivre les critères exclus

      // Gérer les exclusions
      function toggleExclusion(criterionId) {
         excludedCriteria[criterionId] = document.getElementById(`exclude - ${criterionId}`).checked;
         calculateFinalResults(); // Recalculer après modification
      }

      // Calcul des résultats globaux
      function calculateFinalResults() {
         let totalScores = { auto: 0, formative: 0, sommative: 0 };
         let count = { auto: 0, formative: 0, sommative: 0 };

         criteria.forEach(crit => {
            if (excludedCriteria[crit.id]) return; // Ne pas inclure si exclu

            ['auto', 'formative', 'sommative'].forEach(level => {
               const value = sliderValues[level][crit.id];
               if (value !== undefined) {
                  totalScores[level] += parseInt(value);
                  count[level]++;
               }
            });
         });
         // Mettre à jour les résultats affichés
         ['auto', 'formative', 'sommative'].forEach(level => {
            const average = count[level] > 0 ? (totalScores[level] / count[level]) : 0;
            document.getElementById(`${level} - average`).textContent = getResultFromValue(average.toFixed(2));
         });
      }

      function calculateGlobalResult(naCount, paCount, aCount, laCount, totalCriteria) {
         // Effectuer le calcul final en fonction des résultats obtenus
         const total = naCount + paCount + aCount + laCount;
         const globalResult = (aCount + laCount) / totalCriteria;
         return globalResult >= 0.5 ? 'A' : 'PA';
      }

      function getResultFromValue(value) {
         // Convertir la moyenne en appréciation (selon moi ???)
         if (value <= 1) return "NA";
         if (value <= 2) return "PA";
         if (value <= 2.5) return "A";
         return "LA";
      }

      function initializeSliderValues() {
         // Initialiser les valeurs des sliders pour chaque critère et chaque onglet
         criteria.forEach(crit => {
            ['auto', 'formative', 'sommative'].forEach(level => {
               if (!sliderValues[level][crit.id]) {
                  sliderValues[level][crit.id] = 0; // Valeur par défaut
               }

               // Mettre à jour l'interface utilisateur
               const slider = document.querySelector(`input[data - id= "${crit.id}"][data - level="${level}"]`);
               if (slider) {
                  slider.value = sliderValues[level][crit.id];
                  const resultDiv = document.getElementById(`result - ${crit.id}`);
                  resultDiv.innerText = appreciationLabels[slider.value];
               }
            });
         });

         // Recalculer les résultats une fois les valeurs initiales définies
         calculateFinalResults();
      }

      renderCategories();

      getDateDefault();
   </script>


</body>

</html>